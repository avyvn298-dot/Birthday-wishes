<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Abdullah's 17th Birthday Quest</title>
<style>
:root{
  --bg1:#06131b; --bg2:#0c2b3f; --ui:#e8fbff; --accent:#ff6f61;
  --pixel-font: "Courier New", monospace;
}
html,body{margin:0;padding:0;height:100%;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--ui);font-family:var(--pixel-font);}
.wrap{max-width:980px;margin:12px auto;padding:12px;text-align:center;}
h1{margin:6px 0;font-size:20px;}
.dialogue{width:min(920px,96%);margin:10px auto;background:rgba(0,0,0,0.55);padding:14px;border-radius:8px;border:3px solid rgba(255,255,255,0.03);text-align:left;}
.dialogue .text{min-height:56px;}
.choices{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;}
.btn{background:var(--accent); color:#fff; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; font-weight:700;}
canvas{display:block;margin:12px auto;border:6px solid #041b26;background:#04121a;border-radius:10px;max-width:100%;}
.hud{max-width:920px;margin:6px auto;display:flex;justify-content:space-between;align-items:center;color:var(--ui);}
.mutebtn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--ui);padding:6px 8px;border-radius:6px;cursor:pointer;}
.assistBtn{position:fixed;right:16px;top:16px;background:transparent;border:2px solid rgba(255,255,255,0.06);color:var(--ui);padding:8px;border-radius:10px;cursor:pointer;}
.controlsMobile{display:none;position:fixed;left:0;right:0;bottom:8px;justify-content:space-between;padding:0 40px;pointer-events:none;}
.controlBtn{width:72px;height:72px;border-radius:12px;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;font-size:22px;color:var(--ui);pointer-events:auto;}
.hidden{display:none;}
@media (max-width:720px){ .controlsMobile{display:flex} .dialogue .text{font-size:16px} h1{font-size:18px} }
</style>
</head>
<body>
<div class="wrap">
<h1>üéÆ Abdullah's 17th Birthday Quest ‚Äî üéÇ Adventure</h1>

<div id="dialogue" class="dialogue" aria-live="polite">
  <div id="dialogueText" class="text"></div>
  <div id="dialogueChoices" class="choices"></div>
  <div style="margin-top:8px;text-align:right"><button id="dialogueContinue" class="btn hidden">Continue</button></div>
</div>

<div id="hud" class="hud hidden">
  <div><strong id="playerName">Abdullah Naveed</strong></div>
  <div id="score">Score: 0 / 17</div>
  <div style="display:flex;gap:8px;align-items:center">
    <button id="muteBtn" class="mutebtn">üîä Music: On</button>
  </div>
</div>

<canvas id="game" width="820" height="520" class="hidden" aria-label="Birthday game canvas"></canvas>

<div id="final" class="dialogue hidden" style="text-align:center">
  <div id="finalText" style="font-weight:900;font-size:20px;"></div>
  <div style="margin-top:10px">
    <button id="playAgain" class="btn">Play Again</button>
    <button id="downloadCert" class="btn">Download Certificate</button>
  </div>
</div>
</div>

<button id="assistBtn" class="assistBtn" title="Assist (make it easy) ‚ù§Ô∏è">‚ù§Ô∏è Assist: Off</button>

<div class="controlsMobile" id="mobileControls">
  <div class="controlBtn" id="leftBtn">‚óÄ</div>
  <div class="controlBtn" id="jumpBtn">‚¨Ü</div>
  <div class="controlBtn" id="rightBtn">‚ñ∂</div>
</div>

<script>
/* ================= CONFIG ================= */
const NAME = "Abdullah Naveed";
const TARGET_SCORE = 17;
const SHIRT_COLOR = "#2a9df4";
const HAIR_COLOR = "#2b1a0e";
const SKIN_COLOR = "#f0d6b6";
let DIFFICULTY = 1.0; // normal
let ASSIST_ON = false;
let MUSIC_ON = true;
const PLAYER_SPEED = 3.6, JUMP_SPEED=-11, GRAVITY=0.6;
let running=false, lastTime=0, cameraX=0;

/* ======= Canvas & World ======= */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d', {alpha:false});
let canvasW=canvas.width, canvasH=canvas.height;
const WORLD_W = 1600;
const player = {x:80,y:300,vx:0,vy:0,w:16,h:24,onGround:false,score:0,drawY:0};
let platforms=[], items=[], enemies=[];

/* ======== Sprites & Palettes ======== */
const heroSprite=[
[0,0,0,2,2,2,2,2,2,2,0,0,0,0,0,0],
[0,0,2,2,2,2,2,2,2,2,2,0,0,0,0,0],
[0,0,3,3,1,1,1,1,1,1,1,3,3,0,0,0],
[0,3,1,1,1,1,1,1,1,1,1,1,3,0,0,0],
[0,3,1,1,1,1,1,1,1,1,1,1,3,0,0,0],
[0,3,1,1,1,1,1,1,1,1,1,1,3,0,0,0],
[0,0,3,3,1,1,1,1,1,1,1,3,3,0,0,0],
[0,0,0,0,4,4,4,4,4,4,4,0,0,0,0,0],
[0,0,0,0,4,4,4,4,4,4,4,0,0,0,0,0],
[0,0,0,0,4,4,4,4,4,4,4,0,0,0,0,0],
[0,0,0,0,4,4,4,4,4,4,4,0,0,0,0,0],
[0,0,0,0,4,4,4,4,4,4,4,0,0,0,0,0],
[0,0,0,0,4,4,4,4,4,4,4,0,0,0,0,0],
[0,0,0,0,5,5,0,0,0,5,5,0,0,0,0,0],
[0,0,0,0,5,5,0,0,0,5,5,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
];
function heroPalette(){ return [null, SKIN_COLOR, HAIR_COLOR, SKIN_COLOR, SHIRT_COLOR, "#1b1b1b"]; }

const giftSprite=[[0,0,6,6,6,6,0,0],[0,6,2,2,2,2,6,0],[6,2,3,3,3,3,2,6],[6,2,3,3,3,3,2,6],[6,2,3,3,3,3,2,6],[6,2,2,2,2,2,2,6],[0,6,2,2,2,2,6,0],[0,0,6,6,6,6,0,0]];
const giftPalette=[null,"#fff7d9","#ffd9e0","#d43b6b","#f7a55a","#6b2d46"];

const cakeSprite=[[0,0,0,7,7,7,0,0],[0,0,7,2,2,2,7,0],[0,7,2,3,3,2,2,7],[7,2,3,4,4,3,2,7],[7,2,3,3,3,3,2,7],[0,7,2,2,2,2,7,0],[0,0,7,7,7,7,0,0]];
const cakePalette=[null,"#000","#ffe8c6","#ff6f61","#ffd29c","#fff"];

const bookSprite=[[0,8,8,8,8,8,8,0],[8,2,2,2,2,2,2,8],[8,2,2,2,2,2,2,8],[8,2,2,2,2,2,2,8],[8,2,2,2,2,2,2,8],[0,8,8,8,8,8,8,0]];
const bookPalette=[null,"#fff0c8","#d9d9d9","#a15f3d","#6b6b6b"];

const alarmSprite=[[0,9,9,0,0,9,9,0],[9,2,2,9,9,2,2,9],[9,2,3,3,3,3,2,9],[9,2,3,4,4,3,2,9],[9,2,3,3,3,3,2,9],[9,2,2,9,9,2,2,9],[0,9,9,0,0,9,9,0],[0,0,0,0,0,0,0,0]];
const alarmPalette=[null,"#fff0c8","#ffd8b2","#ff2d55","#ffd966","#2b2b2b"];

const enemySprite=[[0,0,11,11,11,11,0,0,0,0],[0,11,11,11,11,11,11,0,0,0],[11,1,1,1,1,1,1,11,0,0],[11,1,9,1,1,9,1,11,0,0],[11,1,1,1,1,1,1,11,0,0],[11,1,1,1,1,1,1,11,0,0],[0,11,11,11,11,11,11,0,0,0],[0,0,11,11,11,11,0,0,0,0]];
const enemyPalette=[null,"#ffd6c6","#a83b3b","#ffd6c6","#000","#000","#000","#ff5a5a"];

/* ===== Helper: draw sprites ===== */
function drawPixelSprite(sprite,palette,dx,dy,scale=3){
  for(let yy=0;yy<sprite.length;yy++){
    for(let xx=0;xx<sprite[0].length;xx++){
      const v=sprite[yy][xx];
      if(!v) continue;
      ctx.fillStyle=palette[v];
      ctx.fillRect(Math.round(dx+xx*scale),Math.round(dy+yy*scale),scale,scale);
    }
  }
}

/* ===== World & Platforms ===== */
function makeWorld(){
  platforms=[
    {x:0,y:440,w:WORLD_W,h:80},
    {x:120,y:360,w:220,h:16},
    {x:420,y:300,w:160,h:16},
    {x:620,y:240,w:180,h:16},
    {x:880,y:320,w:180,h:16},
    {x:1160,y:260,w:200,h:16},
    {x:1360,y:340,w:200,h:16}
  ];

  items=[];
  const collectibleTypes=['gift','cake'];
  platforms.forEach((p,i)=>{
    if(i===0) return;
    const spots=Math.max(1,Math.floor(p.w/120));
    for(let s=0;s<spots;s++){
      const px=p.x+30+s*(p.w/spots);
      const t=collectibleTypes[(s+i)%collectibleTypes.length];
      items.push({x:px+(Math.random()*30-15),y:p.y-(8*3)-(Math.random()*6),type:t,picked:false});
    }
  });
  for(let k=0;k<6;k++){
    items.push({x:1200+k*40+Math.random()*30,y:200+Math.random()*60,type:(k%2===0?'gift':'cake'),picked:false});
  }
  const obstacleTypes=['book','alarm'];
  for(let p of platforms){
    if(Math.random()<0.5 && p!==platforms[0]){
      const ox=p.x+20+Math.random()*(p.w-40);
      if(!items.some(it=>Math.abs(it.x-ox)<80)){
        items.push({x:ox,y:p.y-(8*3),type:obstacleTypes[Math.floor(Math.random()*obstacleTypes.length)],picked:false});
      }
    }
  }

  enemies=[
    {x:500,y:260,vx:1.2*DIFFICULTY,range:[480,720]},
    {x:980,y:280,vx:1.4*DIFFICULTY,range:[920,1200]},
    {x:1320,y:300,vx:1.1*DIFFICULTY,range:[1260,1440]}
  ];
}

/* ===== Camera helper ===== */
function worldToScreen(wx){return Math.round(wx-cameraX);}

/* ===== Collision helper ===== */
function rectsOverlap(ax,ay,aw,ah,bx,by,bw,bh){
  return ax<bx+bw && ax+aw>bx && ay<by+bh && ay+ah>by;
}

/* ===== Game Draw ===== */
function draw(){
  ctx.fillStyle="#04121a"; ctx.fillRect(0,0,canvasW,canvasH);
  for(let s=0;s<40;s++){
    ctx.fillStyle=`rgba(255,255,255,${0.01+(s%6)*0.01})`;
    const sx=((s*73)-cameraX*0.08)%canvasW;
    const sy=(40+(s*17))%(canvasH*0.5);
    ctx.fillRect(sx,sy,1,1);
  }

  for(let p of platforms){
    const sx=worldToScreen(p.x), sy=p.y, sw=p.w, sh=p.h;
    ctx.fillStyle="#08303f"; ctx.fillRect(sx,sy,sw,sh);
    ctx.fillStyle="#0d4960"; ctx.fillRect(sx,sy,sw,6);
  }

  for(let it of items){
    if(it.picked) continue;
    const sx=worldToScreen(it.x), sy=it.y;
    if(it.type==='gift') drawPixelSprite(giftSprite,giftPalette,sx,sy,3);
    if(it.type==='cake') drawPixelSprite(cakeSprite,cakePalette,sx,sy,3);
    if(it.type==='book') drawPixelSprite(bookSprite,bookPalette,sx,sy,3);
    if(it.type==='alarm') drawPixelSprite(alarmSprite,alarmPalette,sx,sy,3);
  }

  for(let en of enemies){
    drawPixelSprite(enemySprite,enemyPalette,worldToScreen(en.x),en.y,3);
  }

  drawPixelSprite(heroSprite,heroPalette(),worldToScreen(player.x),player.drawY
